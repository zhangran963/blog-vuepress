---
title: '对比Vue2的改进'
---

## 与 Vue2 对比

1. 函数式

* 对类型友好, 支持 ts; 

2. 标准化, 简化, 一致性

* `app.$mount()` => `app.mount()`

3. 对 tree-shaking 优化(摇树优化)

* `Vue.component` => `app.component` : 静态方法转到实例上

4. 复用性 composition api
5. 性能优化: 响应式, 编译期优化
6. 拓展性: 自定义渲染器

## 独立的响应式 API

* reactive/ref/toRefs
* 拓展性，方便第三方开发

## 响应式

### Vue2

1. 遍历所有 key(若对象大, 耗性能)
2. watcher 等占用内存大
3. 数组的 hack 处理
4. 动态增删响应式数据的处理
5. 不支持 Map、Set

### Vue3

1. 懒处理(执行时)

## 虚拟 DOM

* 对真实 DOM 的抽象, 是 js 对象, 能表示基本结构; 

优势:

1. 人为操作 DOM, 因为不规范, 无优化等, 容易引起重拍重绘的操作;
2. 方便做 patch 操作(前后比对), 高效更新;
3. (数据驱动, 只驱动 vnode 更新)虚拟 DOM 作为结构, 能普遍性应用到其它平台;
4. vnode 层做兼容、优化等处理(由编译器做)；

## patch 算法

### patch 优化(模板分析过程)

* 静态节点提升
* 补丁标记+动态属性记录; 类似`['title', 'id']`标记出动态的属性; 
* 缓存`事件处理程序`
  + 函数最好不更新; (不像变量值, 可以即时更新)
* 块 block
  + `动态块的节点信息`存储到`根节点`里, 以后递归时, 就不用查看内部了; 
